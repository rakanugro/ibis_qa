<div class="row">
	<div class="col-lg-12">
		<ol class="breadcrumb">
			<li>Administrasi</li>
			<li class="active"><span>Log Nota</span></li>
		</ol>

		<h1>LOG NOTA</h1>
	</div>
</div>

<div class="container">
    <div class="row">
		<div class="main-box clearfix">
			<header class="main-box-header clearfix"></header>
			<div class="box box-primary" style="padding: 10px;">
				<div class="box-body">
					<div class="row">
				  		<form class="form-horizontal" action="#" method="post" id="form2">
							<div class="col-md-6">
								<div class="box-body">
									<div class="form-group">
										<div class="box-body">
											<label for="" class="col-sm-3 control-label">No Nota</label>
											<div class="row">
												<div class="col-xs-6">
						                  			<input type="text" name="TRX_NUMBER" id="TRX_NUMBER" class="form-control" placeholder="No Nota">
						                		</div>
					                		</div>
					             		</div>
				             		</div>
				             		<div class="form-group">
										<div class="box-body">
											<label for="" class="col-sm-3 control-label">Layanan</label>
											<div class="row">
												<div class="col-xs-6">
													<select onchange="jnsNota()" name="INV_NOTA_LAYANAN" id="INV_NOTA_LAYANAN" class="form-control select2" style="width: 100%;">
														<option value="">All</option>
														<option value="KPL">KAPAL</option>
														<option value="BRG">BARANG</option>
														<option value="PTKM">PETIKEMAS</option>
														<option value="RUPA">RUPA-RUPA</option>
													</select>
												</div>
											</div>
										</div>
									</div>

				             		<div class="form-group">
										<div class="box-body">
											<label for="" class="col-sm-3 control-label">Jenis Nota</label>
											<div class="row">
												<div class="col-xs-6">
													<select for="" class="form-control select" style="width: 100%;" name="INV_NOTA_JENIS" id="INV_NOTA_JENIS">
	                                                        	<option value="">All</option>
	                                                            <option value="BRG01">NOTA TAGIHAN JASA BARANG</option>
																<option value="BRG02">NOTA DERMAGA PENUMPUKAN</option>
																<option value="BRG04">NOTA ANGKUTAN LANGSUNG</option>
																<option value="BRG10">USAHA TERMINAL</option>
																<option value="KPL01">PELAYARAN DALAM NEGERI</option>
																<option value="KPL02">PELAYARAN LUAR NEGERI</option>
																<option value="PTKM00">RECEIVING</option>
																<option value="PTKM01">DELIVERY</option>
																<option value="PTKM02">BONGKAR MUAT</option>
																<option value="PTKM05">BEHANDLE</option>
																<option value="PTKM07">PERPANJANGAN DELIVERY</option>
																<option value="PTKM08">BATAL MUAT</option>
																<option value="RUPA04">NOTA LISTRIK</option>
																<option value="RUPA05">NOTA TANAH DAN BANGUNAN</option>
																<option value="RUPA06">NOTA PAS PELABUHAN</option>
																<option value="RUPA07">NOTA RETRIBUSI ALAT</option>
																<option value="RUPA12">NOTA LAIN MANUAL</option>
																<option value="RUPA13">NOTA SEWA ALAT USTER</option>

	                                                        </select>
												</div>
											</div>
										</div>
									</div>

				             		<!-- <div class="form-group">
										<div class="box-body">
											<label for="" class="col-sm-3 control-label">Periode</label>
											<div class="row">
												<div class="col-xs-4">
						                 <input type="date" name="start_periode" id="start_periode" class="form-control" placeholder="Start Date">
						              </div>
						              <div class="col-xs-4">
						                 <input type="date" name="end_periode" id="end_periode" class="form-control" placeholder="End Date">
						               </div>
					                		</div>
					             		</div>
				             		</div> -->

				             		<!-- <div class="form-group">
										<div class="box-body">
											<label for="" class="col-sm-3 control-label">Layanan</label>
											<div class="row">
												<div class="col-xs-6">
													<select class="form-control select2" name="SLAYANAN" id="SLAYANAN"  style="width: 100%;"> -->
														<!-- <option value="" disabled selected>All</option> -->
													<!-- 	<option value="all">All</option>
														<option value="kapal">KAPAL</option>
														<option value="barang">BARANG</option>
														<option value="petikemas">PETIKEMAS</option>
														<option value="ruparupa">RUPARUPA</option>
													</select>
												</div>
											</div>
					             		</div>
				             		</div> -->
								</div>
							</div>
							<div class="col-md-6">
								<div class="box-body">
									<div class="form-group">
										<div class="box-body">
											<label for="" class="col-sm-3 control-label">Aktivitas</label>
											<div class="row">
												<div class="col-xs-6">
						                  			<input type="text" name="ACTIVITY" id="ACTIVITY" class="form-control" placeholder="Aktivitas">
						                		</div>
					                		</div>
					             		</div>
				             		</div>
				             		<div class="form-group">
										<div class="box-body">
											<label for="" class="col-sm-3 control-label">User Name</label>
											<div class="row">
												<div class="col-xs-6">
						                  			<input type="text" name="INV_USER_NAME" id="INV_USER_NAME" class="form-control" placeholder="Masukan Username">
						                		</div>
					                		</div>
					             		</div>
				             		</div>
								</div>
							</div>

							<div class="box-body">
							            <div class="col-sm-12 text-right">
								              <button type="button" onclick="clearreset()"  class="btn btn-primary btn-sm" data-toggle="" data-target=""> Clear</button>
								              <button type="submit" onclick="loaddata()" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#myModal"><i class="fa fa-search"></i> Search</a></button>
							          		<!-- </div> -->
							            </div>
			          		</div>

						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- <div class="row">
	<div class="box-body">
		<div class="form-group">
			<div class="text-right">

			    <button  type="button" class="btn btn-sm btn-danger" data-toggle="modal" data-target="#add_entity"><i class="fa fa-plus"></i></button>
			</div>
		</div>
	</div>
</div> -->
<!-- <button type="Clear" class="btn btn-info btn-lg" data-toggle="modal" data-target="#add_entity" style="float: right;"><i class="fa fa-plus-square"></i></button> -->

<div class="container">
    <div class="row">
	    <div class="clo-lg-12">
		    <div class="main-box clearfix">
			    <div class="main-box-body clearfix">
				    <div class="table-responsive">

				    </div>
			    </div>
		    </div>
	    </div>
    </div>
</div>
<input type="hidden" value="" name="ID" id="ID" class="form-control" placeholder="Kode Entity"/>



<input type="hidden" value="" name="ROWID" id="ROWID" class="form-control" placeholder="Kode Entity"/>
<input type="hidden" value="" name="ROWID1" id="ROWID1" class="form-control" placeholder="Kode Entity"/>
<input type="hidden" value="" name="ROWID2" id="ROWID2" class="form-control" placeholder="Kode Entity"/>
<input type="hidden" value="" name="ROWID3" id="ROWID3" class="form-control" placeholder="Kode Entity"/>
<input type="hidden" value="" name="ROWID4" id="ROWID4" class="form-control" placeholder="Kode BANK"/>
<input type="hidden" value="" name="ROWID5" id="ROWID5" class="form-control" placeholder="Kode SIGNBANK"/>

<script type="text/javascript" src="<?php echo base_url(); ?>assets/plugins/jQuery/jquery-3.1.1.min.js"></script>
<script type="text/javascript" src="<?php echo base_url(); ?>assets/plugins/datepicker/bootstrap-datepicker.js"></script>

<script type="text/javascript">
function PreviewImage() {
var oFReader = new FileReader();
oFReader.readAsDataURL(document.getElementById("INV_ENTITY_LOGO").files[0]);
oFReader.onload = function (oFREvent)
 {
    document.getElementById("uploadPreview").src = oFREvent.target.result;
};
};
</script>

<script type="text/javascript">
function PreviewEdit() {
var oFReader = new FileReader();
oFReader.readAsDataURL(document.getElementById("INV_ENTITY_LOGO1").files[0]);
oFReader.onload = function (oFREvent)
 {
    document.getElementById("uploadPreview").src = oFREvent.target.result;
};
};
</script>




<script>
 /*$('#start_periode').datepicker({
      autoclose: true,
      format: 'dd/mm/yyyy'
    });

    $('#end_periode').datepicker({
      autoclose: true,
      format: 'dd/mm/yyyy'
      // startDate: '-3d'
    });*/
$( document ).ready(function() {

	//loaddata();


		//table-materai

	// $('#table-materai').({
	// 	"responsive": true,
	// 	"bPaginate": true,
	// 	"bLengthChange": false,
	// 	"bFilter": false,
	// 	"bInfo": false,
	// 	"pageLength": 5,
	// 	"iDisplayLength": 5,
	// 	"bAutoWidth": false });
	// $('#myTable').dataTable({
	// 	"responsive": true,
	// 	"bPaginate": true,
	// 	"bLengthChange": false,
	// 	"bFilter": false,
	// 	"bInfo": false,
	// 	"pageLength": 10,
	// 	"iDisplayLength": 5,
	// 	"bAutoWidth": false });
	});

	function editall($id)
	{
		// alert($id); INV_ENTITY_NAME2
		$('[name="ROWID"]').val($id);
		// $('[name="INV_ENTITY_NAME2"]').val($id);
		editentity($id);
		loaddatamaterai($id);
		loaddatafaktur($id);
		// $('#update_entity').modal('show');
	}

	function saveallnew()
	{
		saveentity();
		savematerai();
		savefaktur();
		// $('#update_entity').modal('show');
	}

	function updateall($id)
	{
		updateentity($id);
		// savematerai($id);
		// savefaktur($id);
		// $('#update_entity').modal('show');
	}
    
    function jnsNota()
  {
      // alert('123');
      // var path = '';
      // path = "<?php echo ROOT.'einvoice/administrasi/masterlognotasearch';?>";
      // // var INV_NOTA_LAYANAN = 'KAPAL';

      // $.post( path, {'<?php echo $this->security->get_csrf_token_name(); ?>' : '<?php echo $this->security->get_csrf_hash(); ?>'
      // ,INV_NOTA_LAYANAN:$("#INV_NOTA_LAYANAN").val()
      // }).done(function( data ) {
      //   // INV_NOTA_JENIS
      //   var parse = JSON.parse(data);
      //   var html = '<option value="" selected>All</option>';
      //   $.each( parse, function( key, value ) {
      //     console.log(value);
      //     html += "<option value='"+value.TRX_NUMBER+"'>"+value.INV_NOTA_JENIS+"</option>"
      //     // alert( key + ": " + value );
      //   });
      //   $("#INV_NOTA_JENIS").html(html);
      //   console.log(data);
      //   // $('#update_unit').modal('show');
      // });

       if ($("#INV_NOTA_LAYANAN").val() != "0") {
			path = "<?php echo ROOT.'einvoice/administrasi/getMstNotaList/';?>/"+$("#INV_NOTA_LAYANAN").val();	
			$.post( path, {
				'<?php echo $this->security->get_csrf_token_name(); ?>' : '<?php echo $this->security->get_csrf_hash(); ?>'
			,
			}).done(function( data ) {
				var data1 = JSON.parse(data);
				console.log(data1);
				$("#INV_NOTA_JENIS").html('<option value="" selected>All</option>');
				for(i=0; i<Object.keys(data1).length; i++){
					$("#INV_NOTA_JENIS").append('<option value='+data1[i].INV_NOTA_CODE+'>'+data1[i].INV_NOTA_JENIS+'</option>');
				}
			});
        	
        } else {
			$("#INV_NOTA_JENIS").html('<option value="" disabled selected>All</option>');
        }



      return false;
  }

	function loaddata(){
		var path = '';
		path = "<?php echo ROOT.'einvoice/administrasi/masterlognotasearch';?>";

		$(".table-responsive").html('<table id="myTable" class="table table-hover"><thead><tr><th>No</th><th>Name User</th><th>Layanan</th><th>Jenis Nota</th><th>No Nota</th><th>Activity</th><th>OrgID</th><th>Unit Code</th><th>Entity Code</th><th>History Date</th></tr></thead><tbody id=show_data></tbody></table>');

			// var log_customer	= $("#customer").val();
			// var start_periode  	= $("#start_periode").val();
			// var end_periode  	= $("#end_periode").val();

			// var ID_NOTA 	= $("#ID_NOTA").val();
		var TRX_NUMBER 	= $("#TRX_NUMBER").val();
		var INV_NOTA_LAYANAN  = $("#INV_NOTA_LAYANAN").val();
		var INV_NOTA_JENIS = $("#INV_NOTA_JENIS").val();
		var ACTIVITY = $("#ACTIVITY").val();
		var INV_USER_NAME = $("#INV_USER_NAME").val();


		// var MODULE 		= '';
		/*var tanggal = [{no:"01",tgl:"JAN"},{no:"02",tgl:"FEB"},{no:"03",tgl:"MAR"},{no:"04",tgl:"APR"},{no:"05",tgl:"MAY"},{no:"06",tgl:"JUN"},{no:"07",tgl:"JUL"},{no:"08",tgl:"AUG"},{no:"09",tgl:"SEP"},{no:"10",tgl:"OCT"},{no:"11",tgl:"NOV"},{no:"12",tgl:"DEC"}];*/
		// alert(INV_ENTITY_CODE);
		$.post( path, {'<?php echo $this->security->get_csrf_token_name(); ?>' : '<?php echo $this->security->get_csrf_hash(); ?>',
			TRX_NUMBER:TRX_NUMBER,
			INV_NOTA_LAYANAN:INV_NOTA_LAYANAN,
			INV_NOTA_JENIS:INV_NOTA_JENIS,
			ACTIVITY:ACTIVITY,
			INV_USER_NAME:INV_USER_NAME
			// START_DATE:start_periode,
			// END_DATE:end_periode,
			// ID_NOTA:ID_NOTA,
			// CUSTOMER_NAME:log_customer,
			// MODULE:MODULE

		}).done(function( data ) {
			var data1 = JSON.parse(data);
			// alert(data1);die;
			var html = '';''
			

			var i;
			var $no=0;
			for(i=0; i<Object.keys(data1).length; i++){
				/*var m = data1[i].TRX_DATE.split("-");
				for (var j = 0; j < tanggal.length; j++) {
					if(m[1]==tanggal[j].tgl){
						data1[i].TRX_DATE = m[0]+"-"+tanggal[j].no+"-"+m[2];
					}
				}*/
				var tanggalbaru = data1[i].AC;

				$no++;
				html += '<tr>'+
				
						'<td>'+$no+'</td>'+
						'<td>'+data1[i].INV_USER_NAME+'</td>'+
						'<td>'+data1[i].INV_NOTA_LAYANAN+'</td>'+
						'<td>'+data1[i].INV_NOTA_JENIS+'</td>'+
						'<td>'+data1[i].TRX_NUMBER+'</td>'+
						'<td>'+data1[i].ACTIVITY+'</td>'+
						'<td>'+data1[i].ORG_ID+'</td>'+
						'<td>'+data1[i].UNIT_CODE+'</td>'+
						'<td>'+data1[i].ENTITY_CODE+'</td>'+
						'<td>'+data1[i].AC+'</td>'+
						'</tr>';
			}
			// alert(html);die;
			$('#show_data').html(html);

			$('#myTable').dataTable({
				"sDom": '<"top"i>rt<"bottom"flp><"clear">',
				"destroy": true,
				"responsive": true,
				"bPaginate": true,
				"bLengthChange": true,
				"bFilter": false,
				"bInfo": false,
				"iDisplayLength": 5,
				// "dom": '<"bottom"l>'
				"pageLength": 10 });
	        });

        return false;
	}

	

$( document ).ready(function() {
		//loaddata();
		// alert( "ready!" );
	});

	function clearreset(){
		window.location.reload(true);
	}

	$("#form2").on('submit',(function(e) {
		e.preventDefault();
		loaddata();
	}));

	
	function SetDate($date){
		var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
							"Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
		var dt1;
		var formattedDate1 = new Date($date);
		var d1 = formattedDate1.getDate();
		var m1 = monthNames[formattedDate1.getMonth()];
		var y1 = formattedDate1.getFullYear();
		dt1  = d1+'-'+m1+'-'+y1;

		return dt1;
	}

	function GetDate(str)
	{
		var arr = str.split("-");
		var months = ["jan", "feb", "mar", "apr", "may", "jun", "jul", "aug", "sep", "oct", "nov", "dec"];

		var month = (1+months.indexOf(arr[1].toLowerCase())).toString();
		if(month.length==1) month='0'+month;
		var year = '20' + parseInt(arr[2]);
		var result = year + '-' + month + '-' + parseInt(arr[0]);
		return result;
	}

</script>
